# .github/workflows/deploy.yml

# ã“ã®è‡ªå‹•åŒ–ãƒ«ãƒ¼ãƒ«ã®åå‰ã§ã™
name: Build and Deploy to GitHub Pages

# ã“ã®ãƒ«ãƒ¼ãƒ«ã‚’ã„ã¤å®Ÿè¡Œã™ã‚‹ã‹ã®è¨­å®šã§ã™
on:
  # 1. 5åˆ†ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œã—ã¾ã™
  schedule:
    - cron: '*/5 * * * *'
  
  # 2. GitHubã®Actionsã‚¿ãƒ–ã‹ã‚‰æ‰‹å‹•ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™
  workflow_dispatch:
  
  # 3. mainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰ã—ãŸã¨ãã‚‚å®Ÿè¡Œã—ã¾ã™
  push:
    branches:
      - main

# å®Ÿè¡Œã™ã‚‹ä½œæ¥­å†…å®¹ã§ã™
jobs:
  build-and-deploy:
    # æœ€æ–°ã®Ubuntuï¼ˆLinuxï¼‰ç’°å¢ƒã§ä½œæ¥­ã—ã¾ã™
    runs-on: ubuntu-latest
    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—1ï¼šãƒªãƒã‚¸ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»®æƒ³ç’°å¢ƒã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # ã‚¹ãƒ†ãƒƒãƒ—2ï¼šNode.jsã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«æº–å‚™ã—ã¾ã™
      - name: Setup Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      # ã‚¹ãƒ†ãƒƒãƒ—3ï¼šå¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ (npm install)
      - name: Install dependencies ğŸ“¦
        run: npm install

      # ã‚¹ãƒ†ãƒƒãƒ—4ï¼šbuild.js ã‚’å®Ÿè¡Œã—ã¦ã€ã‚µã‚¤ãƒˆã‚’ç”Ÿæˆã—ã¾ã™
      - name: Build static site ğŸ”¨
        run: node build.js
        env:
          # ã“ã“ã§ã€ã‚¹ãƒ†ãƒƒãƒ—4ã§è¨­å®šã—ãŸç§˜å¯†ã®éµã‚’ build.js ã«æ¸¡ã—ã¾ã™
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}

      # ã‚¹ãƒ†ãƒƒãƒ—5ï¼šç”Ÿæˆã•ã‚ŒãŸã‚µã‚¤ãƒˆï¼ˆdistãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ï¼‰ã‚’å…¬é–‹ã—ã¾ã™
      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          # GitHubãŒè‡ªå‹•ã§ç™ºè¡Œã—ã¦ãã‚Œã‚‹ç‰¹åˆ¥ãªãƒˆãƒ¼ã‚¯ãƒ³ã§ã™
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # build.js ãŒå‡ºåŠ›ã—ãŸ dist ãƒ•ã‚©ãƒ«ãƒ€ã‚’å…¬é–‹å¯¾è±¡ã«ã—ã¾ã™
          publish_dir: ./dist