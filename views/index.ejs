<%# views/index.ejs (æœ¬å½“ã®æœ€çµ‚å®Œæˆç‰ˆ) %>
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ¥ºã·ã‚†ã‚†ãªé›†ä¼šå ´ğŸ¥º - ã·ã‚†ã‚†å¥½ãã®ãŸã‚ã®åŒ¿åæ²ç¤ºæ¿</title>
<meta name="description" content="ã·ã‚†ã‚†ğŸ¥ºå¥½ããŒã“ãã£ã¦é›†ã¾ã‚‹ã¨å™‚ã®æ²ç¤ºæ¿" />
<meta name="keywords" content="æ²ç¤ºæ¿,åŒ¿å,é›‘è«‡,è¶£å‘³,ã·ã‚†ã‚†" />
<meta property="og:title" content="ğŸ¥ºã·ã‚†ã‚†ãªé›†ä¼šå ´ğŸ¥º" />
<meta property="og:description" content="ã·ã‚†ã‚†ğŸ¥ºå¥½ããŒã“ãã£ã¦é›†ã¾ã‚‹ã¨å™‚ã®æ²ç¤ºæ¿" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://hikakinmania4-cmyk.github.io/puyuyu-na-shukaijo/" />
<meta property="og:image" content="https://i.ibb.co/93Stdh8x/96a86591b41f.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="author" content="puyuyu" />
<meta name="theme-color" content="#1565c0" />

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<!-- å…ƒã®ã‚³ãƒ¼ãƒ‰ã«ã‚ã£ãŸCSSã¯å…¨ã¦ãã®ã¾ã¾ã§ã™ -->
<style>
  :root{--primary:#1565c0;--accent:#0288d1;--bg:#f5f7fb;--card:#ffffff;--muted:#6b7280;--danger:#ef4444;--text-main:#111827;--text-muted:#6b7280;--border-color:#e5e7eb;}
  .dark-mode{--primary:#60a5fa;--accent:#38bdf8;--bg:#111827;--card:#1f2937;--muted:#9ca3af;--text-main:#f9fafb;--text-muted:#9ca3af;--border-color:#374151;}
  *{box-sizing:border-box}
  body{font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragin- Kaku Gothic ProN",Meiryo,sans-serif;background:var(--bg);margin:0;padding:0;color:var(--text-main);transition:background-color .3s,color .3s;}
  header{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
  header h1{margin:0;font-size:18px;flex-grow:1;word-break:break-all;}
  header .controls{display:flex;gap:8px;align-items:center;}
  header .userbox{font-size:13px; margin-left: auto; text-align:right;}
  header button, header a.btn { text-decoration: none; background:rgba(255,255,255,0.14);border:none;color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer; display: inline-flex; align-items: center; gap: 6px; position:relative;}
  header button:hover, header a.btn:hover {background:rgba(255,255,255,0.22)}
  .wrap{max-width:1000px;margin:16px auto;padding:12px}
  .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(2,6,23,0.06);margin-bottom:12px;border:1px solid var(--border-color); transition: background-color .3s, border-color .3s;}
  .card h2{margin:0 0 8px 0;font-size:16px;color:var(--primary);word-break:break-all;}
  .thread-header{display:flex;flex-wrap:nowrap;justify-content:space-between;align-items:flex-start;gap:16px;}
  .thread-header-main{min-width:0;flex-grow:1;}
  .thread-header-meta{text-align:right;flex-shrink:0;}
  input[type="text"],textarea,select{width:100%;padding:8px;border:1px solid var(--border-color);border-radius:8px;font-size:14px;background:var(--card);color:var(--text-main);}
  textarea{min-height:8px;resize:vertical}
  .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;transition:background-color 0.2s;}
  .btn:disabled{background:var(--muted);cursor:not-allowed;}
  .btn.warn{background:var(--danger)}
  .btn.small{padding:6px 8px;font-size:13px;border-radius:6px}
  .btn.liked{background:#e11d48;color:white;}
  .search-box{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;}
  .sort-box{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap; align-items: center;}
  .thread-item, .history-item{padding:10px;border-radius:8px;border:1px solid var(--border-color);display:flex;flex-wrap:nowrap;align-items:center;gap:12px; margin-bottom: 8px;}
  .thread-link{font-weight:600;color:var(--primary);text-decoration:none; display:block;word-break:break-all;}
  .thread-info { flex-grow: 1; display: flex; min-width: 0; }
  .thread-item .thread-info { flex-direction: column; align-items: flex-start; gap: 4px; }
  .history-item .thread-info { flex-direction: column; align-items: flex-start; gap: 4px; position: relative; padding-bottom: 18px; }
  .history-item-res-count { position: absolute; bottom: 0; left: 0; }
  .history-achievement-notify { font-weight: bold; color: var(--primary); font-size: 13px; margin-top: 4px; }
  .thread-tags{display:flex;flex-wrap:wrap;gap:4px;}
  .tag{background:var(--muted);color:var(--text-main);padding:2px 6px;border-radius:4px;font-size:11px;cursor:pointer; text-decoration: none;}
  .thread-title-wrapper{min-width:0;display:flex;align-items:center;gap:8px;}
  .thread-meta-info{display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;text-align:right;}
  .thread-preview-img{width:60px;height:60px;object-fit:cover;border-radius:6px;flex-shrink:0;}
  .meta{font-size:13px;color:var(--text-muted)}
  .pagination-controls{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:16px;}
  /* ...å…ƒã®CSSã¯å…¨ã¦ãã®ã¾ã¾ã§ã™... */
</style>
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã¯å¤‰æ›´ãªã— -->
  <header>
    <h1>ğŸ¥ºã·ã‚†ã‚†ãªé›†ä¼šå ´ğŸ¥º</h1>
    <div class="userbox"><span id="userDisplay"></span></div>
    <div class="controls">
      <a href="/puyuyu-na-shukaijo/" class="btn">ğŸ  ãƒ›ãƒ¼ãƒ </a>
      <a href="/puyuyu-na-shukaijo/history.html" class="btn">ğŸ“œ å±¥æ­´</a>
      <a href="/puyuyu-na-shukaijo/settings.html" class="btn">âš™ï¸ è¨­å®š</a>
      <button id="themeToggleBtn">ğŸŒ™</button>
      <button id="refreshBtn">ğŸ”„ æ›´æ–°</button>
    </div>
  </header>

  <div class="wrap" id="app">
    <!-- â–¼â–¼â–¼ ã“ã“ã‹ã‚‰ãŒä¿®æ­£ç®‡æ‰€ã§ã™ï¼å…ƒã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Œå…¨ã«å¾©å…ƒã—ã¾ã—ãŸ â–¼â–¼â–¼ -->
    <div class="card">
      <h2>æ–°ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆ</h2>
      <input id="newTitle" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ#ã‚¿ã‚° ã§ã‚¿ã‚°ä»˜ã‘ã§ãã¾ã™ï¼‰" style="margin-bottom:8px;">
      <input id="newName" type="text" placeholder="åå‰ï¼ˆä»»æ„ï¼‰" style="margin-bottom:8px;">
      <textarea id="newText" placeholder="æœ¬æ–‡"></textarea>
      <div class="controls" style="justify-content:flex-start; margin-top:8px; gap:8px;">
        <button id="createVoteBtn" class="btn small">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä½œæˆ</button>
        <button id="createDrawBtn" class="btn small">ğŸ¨ ãŠçµµæã</button>
      </div>
      <div style="margin-top:8px;">
        <label for="levelRestrictionSelect" class="small-muted">ãƒ¬ãƒ™ãƒ«åˆ¶é™:</label>
        <select id="levelRestrictionSelect">
          <option value="0">ç„¡åˆ¶é™</option>
          <option value="10">Lv.10ä»¥ä¸Š</option>
          <option value="30">Lv.30ä»¥ä¸Š</option>
          <option value="60">Lv.60ä»¥ä¸Š</option>
          <option value="250">Lv.250ä»¥ä¸Š</option>
          <option value="500">Lv.500ä»¥ä¸Š</option>
          <option value="1000">Lv.1000ä»¥ä¸Š</option>
        </select>
      </div>
      <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
        <div id="newImageContainer"><input id="newImage" type="file" accept="image/*"></div>
        <button class="btn" id="createThreadBtn">ã‚¹ãƒ¬ä½œæˆ</button>
      </div>
    </div>
    <!-- â–²â–²â–² ã“ã“ã¾ã§ãŒä¿®æ­£ç®‡æ‰€ã§ã™ â–²â–²â–² -->

    <div class="card">
      <h2>ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§</h2>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ or #ã‚¿ã‚°å">
        <button id="searchBtn" class="btn small">æ¤œç´¢</button>
        <button id="clearSearchBtn" class="btn small">ã‚¯ãƒªã‚¢</button>
      </div>
      <div class="sort-box">
        <span class="small-muted">ä¸¦ã³æ›¿ãˆ:</span>
        <select id="sortSelect">
          <option value="newPost" selected>æ–°ç€ãƒ¬ã‚¹é †</option>
          <option value="newThread">ã‚¹ãƒ¬ç«‹ã¦é †</option>
          <option value="manyRes">ãƒ¬ã‚¹æ•°é †</option>
        </select>
        <label for="sortReverseCheckbox" class="small-muted" style="display:flex;align-items:center;gap:4px;">
          <input type="checkbox" id="sortReverseCheckbox">é€†é †
        </label>
      </div>

      <!-- EJSã«ã‚ˆã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ç”Ÿæˆéƒ¨åˆ†ã¯å¤‰æ›´ãªã— -->
      <div id="threadListContainer">
        <% if (typeof allThreads !== 'undefined' && allThreads.length > 0) { %>
          <% allThreads.forEach(t => { %>
            <% const postCount = t.postCounter || 0; %>
            <div class="thread-item"
                 data-thread-id="<%= t.id %>"
                 data-last-updated-at="<%= t.lastUpdatedAt %>"
                 data-created-at="<%= t.createdAt %>"
                 data-post-counter="<%= postCount %>"
                 data-title="<%= t.title %>"
                 data-tags="<%= (t.tags || []).join(',') %>">
              <% if (t.previewImg) { %>
                <img src="<%= t.previewImg %>" class="thread-preview-img" alt="preview">
              <% } %>
              <div class="thread-info">
                <div class="thread-title-wrapper">
                  <a class="thread-link" href="thread-<%= t.id %>.html">
                    <%= t.title.replace(/#[\p{L}\p{N}_]+/ug, '').trim() %>
                  </a>
                </div>
                <div class="thread-tags">
                  <% (t.tags || []).forEach(tag => { %>
                    <a href="#" class="tag" data-tag="<%= tag %>"><%= tag %></a>
                  <% }) %>
                </div>
              </div>
              <div class="thread-meta-info">
                <div class="meta"><%= postCount %>ãƒ¬ã‚¹</div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="small-muted">ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
        <% } %>
      </div>
      <div id="paginationContainer"></div>
    </div>
  </div>
  
  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ãªã©ã¯å…ƒã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰çœç•¥ã—ã¦ã„ã¾ã™ãŒã€å¿…è¦ã«å¿œã˜ã¦ç§»æ¤ã—ã¦ãã ã•ã„ -->

  <!-- JavaScriptéƒ¨åˆ†ã¯ã€å …ç‰¢åŒ–ã®ãŸã‚ã«ä¿®æ­£ã—ãŸã‚‚ã®ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™ -->
  <script>
    // ... å‰ã®å›ç­”ã§æç¤ºã—ãŸã€æ¤œç´¢ãƒ»ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ãŒå‹•ãJavaScript ...
  </script>
</body>
</html>